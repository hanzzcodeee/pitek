<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>TikDown</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      color: #fbbf24;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    .popup-enter {
      opacity: 0;
      transform: translateY(20px);
    }
    .popup-enter-active {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 300ms ease, transform 300ms ease;
    }
    .popup-exit {
      opacity: 1;
      transform: translateY(0);
    }
    .popup-exit-active {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 300ms ease, transform 300ms ease;
    }
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    .spinner {
      border: 3px solid transparent;
      border-top-color: #fbbf24;
      border-radius: 50%;
      width: 1.25rem;
      height: 1.25rem;
      animation: spin 1s linear infinite;
    }
    .gradient-border {
      position: relative;
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      border-radius: 0.5rem;
      padding: 1px;
    }
    .gradient-border::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 0.5rem;
      padding: 2px;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
    }
    .card-inner {
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      border-radius: 0.5rem;
      padding: 1.5rem;
    }
    .glow {
      box-shadow: 0 0 15px rgba(251, 191, 36, 0.3);
    }
    .btn-gold {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #1a1a1a;
      transition: all 0.3s ease;
    }
    .btn-gold:hover {
      background: linear-gradient(135deg, #fcd34d 0%, #fbbf24 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(251, 191, 36, 0.4);
    }
    .btn-reset {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      color: #fbbf24;
      transition: all 0.3s ease;
    }
    .btn-reset:hover {
      background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(156, 163, 175, 0.4);
    }
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #1a1a1a;
      border-radius: 3px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border-radius: 3px;
    }
    .text-gold {
      color: #fbbf24;
    }
    .text-light-gold {
      color: #fcd34d;
    }
    input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.3);
    }
    /* Toast Notification - Diubah dari bawah ke atas */
    .toast {
      position: fixed;
      top: 20px; /* Diubah dari bottom ke top */
      left: 50%;
      transform: translateX(-50%) translateY(-20px); /* Tambahkan translateY untuk animasi */
      background: #1a1a1a;
      color: #fbbf24;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease; /* Tambahkan transform transition */
    }
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0); /* Reset translateY saat show */
    }
    .btn-disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .btn-disabled:hover {
      transform: none !important;
      box-shadow: none !important;
    }
    
    /* Menu Styles */
    .menu-container {
      position: relative;
    }
    .menu-button {
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      border: 1px solid #fbbf24;
      color: #fbbf24;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .menu-button:hover {
      background: linear-gradient(135deg, #2d2d2d 0%, #3d3d3d 100%);
      box-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
    }
    .menu-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      border: 1px solid #fbbf24;
      border-radius: 8px;
      padding: 8px 0;
      margin-top: 5px;
      min-width: 150px;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }
    .menu-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    .menu-item {
      padding: 10px 16px;
      color: #fbbf24;
      text-decoration: none;
      display: block;
      transition: all 0.2s ease;
    }
    .menu-item:hover {
      background: rgba(251, 191, 36, 0.1);
    }
    
    /* Page Styles */
    .page {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
      display: none;
    }
    .page.active {
      display: block;
    }
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    .page-title {
      font-size: 2rem;
      font-weight: bold;
      color: #fbbf24;
    }
    .close-page {
      background: none;
      border: none;
      color: #fbbf24;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 5px 10px;
    }
    .history-item {
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      border: 1px solid rgba(251, 191, 36, 0.2);
    }
    .history-item-title {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .history-item-url {
      font-size: 0.9rem;
      color: #fcd34d;
      word-break: break-all;
    }
    .history-item-date {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 5px;
    }
    .about-content {
      max-width: 800px;
      margin: 0 auto;
    }
    .about-section {
      margin-bottom: 30px;
    }
    .about-section h3 {
      color: #fbbf24;
      margin-bottom: 10px;
    }
    .about-section p {
      color: #d1d5db;
      line-height: 1.6;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <header class="flex items-center justify-between px-5 py-6 bg-gradient-to-r from-gray-900 to-gray-800 shadow-lg">
   <div class="flex items-center space-x-4">
    <div class="gradient-border">
      <div class="w-12 h-12 rounded-full flex items-center justify-center bg-gray-800">
        <i class="fas fa-download text-gold text-xl"></i>
      </div>
    </div>
    <h1 class="text-gold text-2xl font-bold tracking-wide select-none">
     TikDown
    </h1>
   </div>
   
   <!-- Menu Button -->
   <div class="menu-container">
     <button class="menu-button flex items-center gap-2">
       <i class="fas fa-bars"></i>
       <span>Menu</span>
     </button>
     <div class="menu-dropdown">
       <a href="#" class="menu-item" id="history-link">
         <i class="fas fa-history mr-2"></i> History
       </a>
       <a href="#" class="menu-item" id="about-link">
         <i class="fas fa-info-circle mr-2"></i> Tentang
       </a>
     </div>
   </div>
  </header>
  
  <main class="flex-grow flex flex-col items-center justify-center px-5 py-12 max-w-4xl mx-auto w-full">
   <h2 class="text-gold text-3xl md:text-4xl font-extrabold mb-6 text-center leading-tight select-none">
    Unduh Video TikTok
    <br/>
    <span class="text-light-gold">Tanpa Watermark</span>
   </h2>
   <p class="text-gray-300 text-base md:text-lg mb-10 text-center max-w-md select-none">
    Tempelkan link video TikTok di bawah ini dan dapatkan video berkualitas tinggi tanpa watermark.
   </p>
   <form autocomplete="off" class="w-full flex flex-col sm:flex-row items-center gap-4 max-w-md mx-auto" id="download-form" novalidate="">
    <input aria-label="TikTok video URL input" autocapitalize="none" autocorrect="off" class="flex-grow rounded-lg px-5 py-4 bg-gray-800 text-gray-200 placeholder-gray-500 text-base focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-offset-0 max-w-full border border-gray-700" id="tiktok-url" placeholder="Tempel link video TikTok di sini" required="" spellcheck="false" type="url"/>
    <div class="flex gap-2">
      <button aria-label="Download TikTok video button" class="btn-gold font-bold rounded-lg px-7 py-4 transition flex items-center justify-center gap-2 whitespace-nowrap min-w-[140px]" id="download-btn" type="submit">
       <i class="fas fa-download fa-lg"></i>
       <span id="btn-text">Unduh</span>
      </button>
      <button aria-label="Reset form button" class="btn-reset font-bold rounded-lg px-4 py-4 transition flex items-center justify-center gap-2 whitespace-nowrap min-w-[60px] hidden" id="reset-btn" type="button">
       <i class="fas fa-redo fa-lg"></i>
      </button>
    </div>
   </form>
   <section aria-atomic="true" aria-live="polite" class="mt-12 w-full gradient-border hidden flex-col items-center max-w-md mx-auto" id="result-section" role="region">
    <div class="card-inner flex flex-col items-center">
      <h3 class="text-gold text-xl font-semibold mb-5 select-none">
       Unduhan Anda
      </h3>
      <video aria-label="Preview of the TikTok video to download" class="rounded-lg max-w-full max-h-80 shadow-lg border border-gray-700" controls="" id="video-preview" playsinline="" preload="metadata">
       <source src="" type="video/mp4"/>
       Browser Anda tidak mendapat tag video.
      </video>
      <a class="mt-6 btn-gold font-bold rounded-lg px-7 py-3 shadow-md transition inline-flex items-center gap-2 whitespace-nowrap" download="" href="#" id="download-link" role="button" tabindex="0">
       <i class="fas fa-file-download fa-lg"></i>
       Unduh Video
      </a>
    </div>
   </section>
  </main>
  
  <footer class="bg-gradient-to-r from-gray-900 to-gray-800 text-gray-400 text-center py-6 select-none mt-8">
   <!-- Teks hak cipta dihapus sesuai permintaan -->
  </footer>
  
  <!-- Popup Overlay -->
  <div aria-hidden="true" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 opacity-0 pointer-events-none backdrop-blur-sm" id="popup-overlay">
   <div aria-describedby="popup-desc" aria-labelledby="popup-title" aria-modal="true" class="gradient-border max-w-md w-full mx-4 relative transform opacity-0 translate-y-5" id="popup" role="dialog">
    <div class="card-inner p-6">
      <button aria-label="Close popup" class="absolute top-4 right-4 text-gray-400 hover:text-yellow-400 transition" id="popup-close">
       <i class="fas fa-times fa-lg"></i>
      </button>
      <img alt="TikTok video cover image" class="w-full rounded-lg mb-5 object-cover max-h-60 mx-auto glow" height="360" id="popup-cover" src="https://storage.googleapis.com/a1aa/image/1063ffd6-17b9-4da7-6030-e19cfcd1e2f6.jpg" width="360"/>
      <p class="text-gray-300 text-sm md:text-base mb-6 max-h-28 overflow-y-auto custom-scrollbar px-2 py-1" id="popup-caption">
      </p>
      <div class="flex justify-center gap-4">
       <a class="btn-gold font-bold rounded-lg px-4 py-3 transition inline-flex items-center gap-2 whitespace-nowrap flex-1 justify-center text-center text-sm" download="tiktok-video.mp4" href="#" id="popup-video-btn" role="button" tabindex="0">
        <i class="fas fa-video"></i>
        Video
       </a>
       <a class="btn-gold font-bold rounded-lg px-4 py-3 transition inline-flex items-center gap-2 whitespace-nowrap flex-1 justify-center text-center text-sm" download="tiktok-audio.mp3" href="#" id="popup-audio-btn" role="button" tabindex="0">
        <i class="fas fa-music"></i>
        Audio
       </a>
      </div>
    </div>
   </div>
  </div>
  
  <!-- Toast Notification - Posisi diubah ke atas -->
  <div class="toast" id="toast"></div>
  
  <!-- History Page -->
  <div class="page" id="history-page">
    <div class="page-header">
      <h2 class="page-title">Riwayat TikDown</h2>
      <button class="close-page" id="close-history">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="history-content">
      <!-- History items will be populated here -->
    </div>
  </div>
  
  <!-- About Page -->
  <div class="page" id="about-page">
    <div class="page-header">
      <h2 class="page-title">Tentang TikDown</h2>
      <button class="close-page" id="close-about">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="about-content">
      <div class="about-section">
        <h3>Apa itu TikDown?</h3>
        <p>TikDown adalah alat online yang memungkinkan Anda mengunduh video TikTok tanpa watermark. Dengan antarmuka yang sederhana dan mudah digunakan, Anda dapat dengan cepat mendapatkan video berkualitas tinggi dari TikTok untuk disimpan di perangkat Anda.</p>
      </div>
      
      <div class="about-section">
        <h3>Cara Menggunakan</h3>
        <p>1. Buka aplikasi TikTok dan pilih video yang ingin diunduh<br>
           2. Tekan tombol "Bagikan" dan salin link video<br>
           3. Tempelkan link video TikTok ke dalam kolom input TikDown<br>
           4. Klik tombol "Unduh" dan tunggu proses selesai</p>
      </div>
      
      <div class="about-section">
        <h3>Fitur</h3>
        <p>- Unduh video TikTok tanpa watermark<br>
           - Kualitas video tinggi<br>
           - Pratinjau video sebelum mengunduh<br>
           - Riwayat unduhan<br>
           - Mendukung semua URL video TikTok<br>
           - Sepenuhnya gratis tanpa biaya tersembunyi<br>
           - Aman dan privat, data tidak disimpan atau dibagikan<br>
           - Antarmuka yang responsif dan mudah digunakan</p>
      </div>
      
      <div class="about-section">
        <h3>Catatan Penting</h3>
        <p>Pastikan Anda memiliki izin dari pembuat konten sebelum mengunduh dan menggunakan video TikTok. TikDown hanya menyediakan alat untuk mengunduh video, dan pengguna bertanggung jawab penuh atas penggunaan konten yang diunduh.</p>
      </div>
        
      <div class="about-section">
        <h3>Teknologi yang Digunakan</h3>
        <p>- HTML5, CSS3, dan JavaScript<br>
           - Tailwind CSS untuk styling<br>
           - API untuk pengunduhan video<br>
      </div>   
      
      
      <div class="about-section">
         <h3>Dikembangkan oleh</h3>
        <p>Farhan dan Sindy<br>
        TikDown dibuat untuk memudahkan pengunduhan video TikTok tanpa watermark.<br>
        
      </div>
    </div>
  </div>
  
  <script>
   const form = document.getElementById("download-form");
   const urlInput = document.getElementById("tiktok-url");
   const resultSection = document.getElementById("result-section");
   const videoPreview = document.getElementById("video-preview");
   const downloadLink = document.getElementById("download-link");
   const downloadBtn = document.getElementById("download-btn");
   const resetBtn = document.getElementById("reset-btn");
   const btnText = document.getElementById("btn-text");
   const toast = document.getElementById("toast");

   const popupOverlay = document.getElementById("popup-overlay");
   const popup = document.getElementById("popup");
   const popupCloseBtn = document.getElementById("popup-close");
   const popupCover = document.getElementById("popup-cover");
   const popupCaption = document.getElementById("popup-caption");
   const popupVideoBtn = document.getElementById("popup-video-btn");
   const popupAudioBtn = document.getElementById("popup-audio-btn");
   
   // Menu elements
   const menuButton = document.querySelector('.menu-button');
   const menuDropdown = document.querySelector('.menu-dropdown');
   const historyLink = document.getElementById('history-link');
   const aboutLink = document.getElementById('about-link');
   
   // Page elements
   const historyPage = document.getElementById('history-page');
   const aboutPage = document.getElementById('about-page');
   const closeHistory = document.getElementById('close-history');
   const closeAbout = document.getElementById('close-about');
   const historyContent = document.getElementById('history-content');
   
   // History storage
   let downloadHistory = JSON.parse(localStorage.getItem('tikdown_history')) || [];

   // Show toast notification
   function showToast(message, duration = 3000) {
     toast.textContent = message;
     toast.classList.add('show');
     
     setTimeout(() => {
       toast.classList.remove('show');
     }, duration);
   }

   function showPopup() {
     popupOverlay.style.pointerEvents = "auto";
     popupOverlay.classList.remove("opacity-0");
     popupOverlay.classList.add("opacity-100");
     popup.classList.remove("opacity-0", "translate-y-5");
     popup.classList.add("opacity-100", "translate-y-0");
   }

   function hidePopup() {
     popup.classList.remove("opacity-100", "translate-y-0");
     popup.classList.add("opacity-0", "translate-y-5");
     popupOverlay.classList.remove("opacity-100");
     popupOverlay.classList.add("opacity-0");
     popupOverlay.style.pointerEvents = "none";
   }

   popupCloseBtn.addEventListener("click", () => {
     hidePopup();
   });

   popupOverlay.addEventListener("click", (e) => {
     if (e.target === popupOverlay) {
       hidePopup();
     }
   });

   function isValidTikTokUrl(url) {
     const regex = /^(https?:\/\/)?(www\.|m\.|vm\.)?(tiktok\.com\/.+|vt\.tiktok\.com\/.+)|https?:\/\/vm\.tiktok\.com\/.+/i;
     return regex.test(url);
   }

   async function fetchTikTokVideo(url) {
     if (!isValidTikTokUrl(url)) {
       throw new Error("URL TikTok tidak valid./");
     }
     
     const apiUrl = `/api/download?url=${encodeURIComponent(url)}`;
     const response = await fetch(apiUrl);
     
     if (!response.ok) {
       const errorData = await response.json();
       throw new Error(errorData.error || "Gagal mengambil data video");
     }
     
     const data = await response.json();
     
     if (!data.success) {
       throw new Error("Video tidak ditemukan atau tidak dapat diunduh");
     }
     
     return data;
   }

   function setLoading(isLoading) {
     if (isLoading) {
       downloadBtn.disabled = true;
       downloadBtn.classList.add('btn-disabled');
       btnText.textContent = "Memproses...";
       if (!downloadBtn.querySelector(".spinner")) {
         const spinner = document.createElement("span");
         spinner.className = "spinner";
         spinner.setAttribute("aria-label", "Loading");
         downloadBtn.insertBefore(spinner, btnText);
       }
     } else {
       downloadBtn.disabled = false;
       downloadBtn.classList.remove('btn-disabled');
       btnText.textContent = "Unduh";
       const spinner = downloadBtn.querySelector(".spinner");
       if (spinner) {
         spinner.remove();
       }
     }
   }

   function resetForm() {
     urlInput.value = "";
     downloadLink.classList.add("opacity-50", "pointer-events-none");
     downloadLink.removeAttribute("href");
     videoPreview.src = "";
     resultSection.classList.add("hidden");
     resetBtn.classList.add("hidden");
     urlInput.focus();
   }

   resetBtn.addEventListener("click", resetForm);

   form.addEventListener("submit", async (e) => {
     e.preventDefault();
     const url = urlInput.value.trim();
     
     if (!url) {
       showToast("Masukkan URL video TikTok terlebih dahulu");
       urlInput.focus();
       return;
     }

     if (!isValidTikTokUrl(url)) {
       showToast("URL TikTok tidak valid.");
       urlInput.focus();
       return;
     }

     // Reset state
     downloadLink.classList.add("opacity-50", "pointer-events-none");
     downloadLink.removeAttribute("href");
     videoPreview.src = "";
     resultSection.classList.add("hidden");

     setLoading(true);

     try {
       const data = await fetchTikTokVideo(url);

       // Cek apakah video tersedia
       const videoUrl = data.video?.nowatermark || data.video?.nowatermark_hd || data.video_url;
       
       if (!videoUrl) {
         throw new Error("Video tidak ditemukan");
       }

       // Set video preview
       videoPreview.src = videoUrl;
       downloadLink.href = videoUrl;
       downloadLink.download = "tiktok-video.mp4";
       downloadLink.innerHTML = '<i class="fas fa-file-download fa-lg"></i> Unduh Video';
       resultSection.classList.remove("hidden");
       downloadLink.classList.remove("opacity-50", "pointer-events-none");

       // Set popup content
       popupCover.src = data.cover || "https://placehold.co/360x360/1a1a1a/fbbf24?text=No+Cover";
       popupCover.alt = `Cover video: ${data.title || 'TikTok Video'}`;
       popupCaption.textContent = data.title || "Tidak ada deskripsi";

       // Set popup buttons
       if (videoUrl) {
         popupVideoBtn.href = videoUrl;
         popupVideoBtn.download = "tiktok-video.mp4";
         popupVideoBtn.classList.remove("opacity-50", "pointer-events-none");
       } else {
         popupVideoBtn.href = "#";
         popupVideoBtn.classList.add("opacity-50", "pointer-events-none");
       }

       if (data.music) {
         popupAudioBtn.href = data.music;
         popupAudioBtn.download = "tiktok-audio.mp3";
         popupAudioBtn.classList.remove("opacity-50", "pointer-events-none");
       } else {
         popupAudioBtn.href = "#";
         popupAudioBtn.classList.add("opacity-50", "pointer-events-none");
       }

       // Tampilkan tombol reset
       resetBtn.classList.remove("hidden");

       // Add to history
       addToHistory(url, data.title || "Video TikTok", videoUrl);
       
       showPopup();
       showToast("Video berhasil ditemukan!");

     } catch (error) {
       console.error("Error:", error);
       showToast(error.message || "Terjadi kesalahan saat memproses video");
     } finally {
       setLoading(false);
     }
   });

   // Menu functionality
   menuButton.addEventListener('click', () => {
     menuDropdown.classList.toggle('show');
   });
   
   // Close menu when clicking outside
   document.addEventListener('click', (e) => {
     if (!menuContainer.contains(e.target)) {
       menuDropdown.classList.remove('show');
     }
   });
   
   // Page navigation
   historyLink.addEventListener('click', (e) => {
     e.preventDefault();
     menuDropdown.classList.remove('show');
     showPage('history');
   });
   
   aboutLink.addEventListener('click', (e) => {
     e.preventDefault();
     menuDropdown.classList.remove('show');
     showPage('about');
   });
   
   closeHistory.addEventListener('click', () => {
     hidePage('history');
   });
   
   closeAbout.addEventListener('click', () => {
     hidePage('about');
   });
   
   function showPage(pageName) {
     if (pageName === 'history') {
       historyPage.classList.add('active');
       loadHistory();
     } else if (pageName === 'about') {
       aboutPage.classList.add('active');
     }
   }
   
   function hidePage(pageName) {
     if (pageName === 'history') {
       historyPage.classList.remove('active');
     } else if (pageName === 'about') {
       aboutPage.classList.remove('active');
     }
   }
   
   // History functionality
   function addToHistory(url, title, videoUrl) {
     const historyItem = {
       url: url,
       title: title,
       videoUrl: videoUrl,
       date: new Date().toISOString()
     };
     
     // Add to beginning of array
     downloadHistory.unshift(historyItem);
     
     // Keep only last 20 items
     if (downloadHistory.length > 20) {
       downloadHistory = downloadHistory.slice(0, 20);
     }
     
     // Save to localStorage
     localStorage.setItem('tikdown_history', JSON.stringify(downloadHistory));
   }
   
   function loadHistory() {
     historyContent.innerHTML = '';
     
     if (downloadHistory.length === 0) {
       historyContent.innerHTML = '<p class="text-gray-400 text-center">Belum ada riwayat unduhan.</p>';
       return;
     }
     
     downloadHistory.forEach(item => {
       const historyItem = document.createElement('div');
       historyItem.className = 'history-item';
       
       const date = new Date(item.date);
       const formattedDate = date.toLocaleDateString('id-ID', {
         day: 'numeric',
         month: 'long',
         year: 'numeric',
         hour: '2-digit',
         minute: '2-digit'
       });
       
       historyItem.innerHTML = `
         <div class="history-item-title">${item.title}</div>
         <div class="history-item-url">${item.url}</div>
         <div class="history-item-date">${formattedDate}</div>
         <div class="mt-2">
           <a href="${item.videoUrl}" class="btn-gold font-bold rounded-lg px-3 py-1 text-sm inline-flex items-center gap-1" download="tiktok-video.mp4">
             <i class="fas fa-download"></i> Unduh Lagi
           </a>
         </div>
       `;
       
       historyContent.appendChild(historyItem);
     });
   }
   
   // Auto-focus input on page load
   window.addEventListener('load', () => {
     urlInput.focus();
   });
  </script>
</body>
</html>